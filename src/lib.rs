/// http://www.vttoth.com/CMS/projects/41-the-lanczos-approximation
///
/// https://github.com/qg-cpt-marseille/sl2cfoam-next
use num::complex::Complex;

const G: f64 = 43.1;
const LANCZOS_COEFFICIENTS: [f64; 42] = [
    2.50662827463100050241576528481104525300698674060993831662992403716826276762115199795150285232035436293022719067253847559454569497025187330515787063680967363,
    20684723915661364238.7827297217057312557567937914753364044476529357212596608762637024407759956790172679161705463893354348881972906450763646607700375314037932,
    -312817069441487817999.947554844510446322305911356752195860466402614585071183858928529075967774968129065951334548364800036639675497251079128631690146729706625,
    2252376842487364035484.05387508656853990454016961496343590140531760755253966450429238842175243216677098787317203395714214445676650125396028590658322280303214,
    -10276456393610250704845.9026832405331121027065829975334973922671943672713470307442404219317189095244450780126193767189884169920055468081507556142124470270728,
    33357894496840392607926.2694143334584059558294415527424294574174515466770496697450756866294345760941484803946442220000339261657809719256785826981042342354248,
    -82001995433263355058855.9991952342363762996483590654333301305938318431073770823061275488550625917261055382022086216681383132667997246172066200869564788326213,
    158661880114475634954158.264385046738700581607457714321428173317695501337221613300880069169986770779500197117862810221187468766619972282079362455881409134293,
    -247929385564855287836669.086654260781676453720413923106145260128196872773701878105250966824796869109954416600621872241048042181935919268582784042746210144567,
    318577712939773570279332.40146806183088169166299001135464773019953239761785557367320127081124423604194210470031110101658073016382878919725440503758845073581,
    -341000247554858097082172.890994522198687948195433360458903984586063291682800679823587213092116475828309838559657742388179612112924781378166992014946254008982,
    306917659637425893931140.250637830910996962352259693414585650711562934351970133261026161851195885084579973131914641053120136073883917209671289858351929894318,
    -233857531002629338103085.878338340506978078628478730880893592778993139624177808943362052456569768060170284496231875685256062959355251562766558867290632854696,
    151562588256467333326071.1915944246928860326100586106788650287348016359963123576439415627592579411934871120920751708612463829650860093972708303629681237215,
    -83805871608176979513571.4354045905423860694514595184472274152430597461768480533422517765410783734878043296870004442202572062095783537035090192692744349598831,
    39602382193814251011718.5515973071822140561202828935611975589255484828565441257506289132229096071492024352213513850903676270528129168043748823317367228103206,
    -15999958692093114752822.4907098088319402371764319692257166482989359201635473507289871514459523610184125612619240886713798333225275896862303459754401942846989,
    5522816698104954820661.27080823619025582638667336830173151158846328355588904825187751626536780780841449077128304815134924913142324761943110671686134883907471,
    -1625809341311699477448.24629111735000294652466064113822967135602419562795009628449231884254621865257612714050058438573142911971551630840299003643131959996796,
    407007784759541399604.361071763667328210742920878565217900040220849879186150037737943470866732610758690721333105142909098320901081392031303861327843473117594,
    -86305646399644818958.7003603229877371416344001543237246602597044631087815559034758222320338092998652217385446153890966988387712172221564756686646016752862398,
    15422460857065507857.7356359914724357969974892803322915842394786398647498280246543073449338100390766114866955073441794399481956151132291172811089907872928449,
    -2307663852330559330.955348135302085690967721803094605236788552534035647909822945760283856447113026206227172554856179165181521837235283809134658849465440472,
    286887874618904916.962669423549642130131069929893255584207433455232509041864282313720594782838923887462988047045688992892500958076175219578379622239642336626,
    -29355879323580024.8496441085266871730092698706795627370489011260228375962193001532308499081626601957966368166940789818598265207692997726979511113483005928139,
    2444774609921193.00804032928223825267619004401849659522382221798112978896548302453157071772295018879256078690227533557239659342077998372140399717709398185058,
    -163497167040150.994162786872005210426035519530061938479275548273839232529436835358664400989629307142846354676546782632237464086570438150639005260096802709719,
    8640397167115.87775264872573760893122138118525195998042282819991806051276651332447368977618994146175626928442350168473321839559931111026919885615613861450336,
    -353946466836.730528890419989878605687722750489225642509542730180590307713263418581445033480102508048920746914861606738725429428463085371424586288470864717034,
    10980320161.1322307968801550254087969513920106173328968096080132958865209753023214154889544055719394648133777348409390775652438716533676305627930647592322023,
    -250763273.530458775944341688798294822474489803494939027895283252258042909248866669963676665695994207712376717940250071247464430884998217368551649986708865039,
    4071477.35023603998308360217102648949903311403603853888191771600712390650378437914840774599653062889636191131313782153381288032452613084088214900216577861914,
    -45000.8670895165488636652934823710140791941032242997833352090046916107147338701539807529428834617343092289584952502606374402155831751500190349238230473058981,
    320.472215091550748415075485483778157916697578129183535971185536062609638583119802448494231219835700453191619822767882712883842254459363717054782396126797926,
    -1.36970690814297383260078883995593903859391197767092868463665226326025634313296510745370458354235758705938768445773611064873494401594480385699791880988861294,
    0.00319863369794435340049321115531520138202389975545923512325662544762994203407848614671572427159051601993009122309753842757834419447199426555693287274751150418,
    -0.00000359159981140079587284775448325255766158083360990987597420437266285004731837433526565247999602511489212524340005551363473620703709114460845830537748362419009,
    0.00000000161868401788864840585425988502408163784980962647459063888557658617189616922268354635474952471887339736536126800239268153162568237025821827120930941202010937,
    -0.000000000000224059435881280018834244185878111046732765351387761375236510813388052012459457403341912918578879516753493868185691279781214484004197586162289666239169671151,
    0.00000000000000000624324914973408130631876635093912898085365490736350045222458647371479833210740307637343055039285898285923169335872814711021369175578042169276096790085017798,
    -0.0000000000000000000000168975538204125520157924793633044501271722097005208454663077188287247379492184403242738307907586472963818809308140075757465605576503254197189833522656223307,
    0.0000000000000000000000000000010568006371294132185291930599093557676889607258538590011333906707733337727792422742676579865158249435472039489931607396550324189637751588265482998759258525,
];

pub struct ComplexGamma {
    pub z: Complex<f64>,
}

impl ComplexGamma {
    pub fn value(self) -> Complex<f64> {
        let ComplexGamma { z } = self;
        let mut zp = Complex {
            re: LANCZOS_COEFFICIENTS[0],
            im: 0.0,
        };
        let z_minus1 = z - 1.0;
        for i in 1..LANCZOS_COEFFICIENTS.len() {
            zp += LANCZOS_COEFFICIENTS[i] / (z_minus1 + i as f64);
        }
        let pow = zp.ln() + (z_minus1 + 0.5) * (z_minus1 + 0.5 + G).ln() - (z_minus1 + 0.5 + G);
        pow.exp()
    }
}
